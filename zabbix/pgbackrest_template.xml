<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.4</version>
    <date>2021-12-18T16:40:41Z</date>
    <groups>
        <group>
            <uuid>748ad4d098d447d492bb935c907f652f</uuid>
            <name>Templates/Databases</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>a2135f96327345bdb1a743502ea5dfbc</uuid>
            <template>t_pgbackrest</template>
            <name>t_pgbackrest</name>
            <description>Template for PGBackRest monitoring</description>
            <groups>
                <group>
                    <name>Templates/Databases</name>
                </group>
            </groups>
            <discovery_rules>
                <discovery_rule>
                    <uuid>d2a6cf21a89841f9a6ce81333663afdf</uuid>
                    <name>stanza discovery</name>
                    <type>TRAP</type>
                    <key>pgbackrest_stanza</key>
                    <delay>0</delay>
                    <filter>
                        <conditions>
                            <condition>
                                <macro>{#STANZA}</macro>
                                <formulaid>A</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>3669e006565c46d58ab183b574fe773c</uuid>
                            <name>Last backup message of {#STANZA}</name>
                            <type>DEPENDENT</type>
                            <key>last_backup_message[{#STANZA}]</key>
                            <delay>0</delay>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.*.status.message</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>RTRIM</type>
                                    <parameters>
                                        <parameter>]</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>LTRIM</type>
                                    <parameters>
                                        <parameter>[</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pgbackrest_check[&quot;{#STANZA}&quot;]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>pgbackrest_stanza</tag>
                                    <value>{#STANZA}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>7273dab8b7894592aa26e6aebbdc5481</uuid>
                            <name>Last backup status of {#STANZA}</name>
                            <type>DEPENDENT</type>
                            <key>last_backup_status[{#STANZA}]</key>
                            <delay>0</delay>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.*.status.code</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>RTRIM</type>
                                    <parameters>
                                        <parameter>]</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>LTRIM</type>
                                    <parameters>
                                        <parameter>[</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>pgbackrest_check[&quot;{#STANZA}&quot;]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>pgbackrest_stanza</tag>
                                    <value>{#STANZA}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>6f29bdab8dfd4ff2839f8bee5c642541</uuid>
                                    <expression>last(/t_pgbackrest/last_backup_status[{#STANZA}])&lt;&gt;0</expression>
                                    <name>Last backup status of {#STANZA} not OK</name>
                                    <priority>HIGH</priority>
                                    <description>Last backup of db {#STANZA} was not ok, check pgbackrest for more info</description>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>aadc833fa4d94b298892a854b0d4085e</uuid>
                            <name>pgbackrest_check pre {#STANZA}</name>
                            <type>ZABBIX_ACTIVE</type>
                            <key>pgbackrest_check[&quot;{#STANZA}&quot;]</key>
                            <history>1d</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <tags>
                                <tag>
                                    <tag>pgbackrest_stanza</tag>
                                    <value>{#STANZA}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>ba471f6380494b1f9e19e892b995b762</uuid>
                                    <expression>nodata(/t_pgbackrest/pgbackrest_check[&quot;{#STANZA}&quot;],24h)=1</expression>
                                    <name>No data received for 1 day for {#STANZA}</name>
                                    <priority>DISASTER</priority>
                                    <description>No data received for 1 day for {#STANZA}</description>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
            </discovery_rules>
        </template>
    </templates>
</zabbix_export>
